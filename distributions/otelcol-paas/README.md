# OpenTelemetry Collector PaaS Distro

This distribution is made specifically to be used in a PaaS environment. It contains a subset of components from [OpenTelemetry Collector Core](https://github.com/open-telemetry/opentelemetry-collector) and [OpenTelemetry Collector Contrib](https://github.com/open-telemetry/opentelemetry-collector-contrib).

## Components

The full list of components is available in the [manifest](manifest.yaml).

### Rules for Component Inclusion

 - Only includes components from Contrib and Core.
 - Only components that are Alpha or higher.
 - All receivers must facilitate the collection of data that is generated by the application running in the PaaS environment or enriching the data by introspecting the PaaS platform.
 - All components must be vendor-neutral.
 - Only exporters that use OTLP are allowed.
   - To facilitate troubleshooting, the nop and debug exporters are present as exceptions.

## Heroku buildpack

This distribution works as a Heroku buildpack.

### Installation

[Install the Heroku CLI, login, and create an
app](https://devcenter.heroku.com/articles/heroku-cli). Add and configure the
buildpack:

```
# cd into the Heroku project directory
# WARNING: running `heroku` command outside of project directories
#          will result in unexpected behavior
cd <HEROKU_APP_DIRECTORY>

# Configure Heroku App to expose Dyno metadata
# This metadata is required by the OpenTelemetry Collector to
# set global dimensions such as `app_name`, `app_id` and `dyno_id`.
# See [here](https://devcenter.heroku.com/articles/dyno-metadata) for more information.
heroku labs:enable runtime-dyno-metadata

# Add buildpack for OpenTelemetry Collector
# Note both lines are required together
# TODO check URI works
heroku buildpacks:add https://github.com/open-telemetry/opentelemetry-collector-releases.git/distributions/otelcol-paas#\
$(curl -s https://api.github.com/repos/open-telemetry/opentelemetry-collector-releases/releases | grep '"tag_name"' | head -n 1 | cut -d'"' -f4)
# For production environment using an explict version number is advised
#heroku buildpacks:add https://github.com/open-telemetry/opentelemetry-collector-releases.git#<TAG_NAME>

# Set required environment variables
heroku config:set OTLP_ENDPOINT=<YOUR OTLP ENDPOINT>

# Optionally define custom configuration file in your Heroku project directory
#heroku config:set CONFIG=/app/mydir/myconfig.yaml

# Create an emptycommit and deploy your app (assumes `main` branch exists)
git commit --allow-empty -m "empty commit"
git push heroku main

# Check logs
#heroku logs -a <app-name> --tail
```

## Advanced Configuration

Use the following environment variables to configure this buildpack:


| Environment Variable | Required | Default                      | Description                           |
|----------------------|----------|------------------------------|---------------------------------------|
| `OTLP_ENDPOINT`      | Yes      |                              | OTLP exporter endpoint                |
| `CONFIG`             | No       | $BUILD_DIR/.otel/config.yaml | Collector configuration file location |
| `LOG_FILE`           | No       | `/dev/stdout`                | Optional log file location            |
| `MEMORY_LIMIT_MIB`   | No       | `512`                        | Memory limit                          |

